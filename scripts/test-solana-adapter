#!/usr/bin/env bash
# test-solana-adapter: Run Solana adapter unit tests
#
# Usage:
#   ./scripts/test-solana-adapter           # Run all tests
#   ./scripts/test-solana-adapter --watch   # Run in watch mode
#
# This script runs the Solana adapter test suite using Jest.

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
cd "$ROOT_DIR/adapters/solana"

WATCH=""

while [[ $# -gt 0 ]]; do
  case $1 in
    --watch|-w)
      WATCH="--watch"
      shift
      ;;
    *)
      echo "Unknown option: $1"
      echo ""
      echo "Usage: ./scripts/test-solana-adapter [--watch]"
      exit 1
      ;;
  esac
done

echo "=== Running Solana Adapter Tests ==="
echo ""

# Ensure dependencies are installed
if [[ ! -d "node_modules" ]]; then
  echo "Installing dependencies..."
  npm ci
  echo ""
fi

echo "Running tests..."
# shellcheck disable=SC2086
npm test -- $WATCH
