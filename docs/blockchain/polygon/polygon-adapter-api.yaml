openapi: 3.0.3
info:
  title: Polygon Blockchain Adapter API
  version: 1.0.0
  description: |
    API specification for the Polygon blockchain adapter container.
    
    This adapter provides blockchain functionality for FanEngagement organizations
    that have selected Polygon as their blockchain platform. It handles:
    - Organization account creation (smart contract deployment)
    - ERC-20 token minting for ShareTypes  
    - Token issuance to members
    - Proposal creation and voting operations
    - Result commitment for verifiability
    
    ## Architecture
    
    The adapter runs as an independent Docker container and communicates with:
    - **FanEngagement Backend**: Receives requests via this REST API
    - **Polygon Network**: Submits transactions via RPC endpoint
    
    ## Security
    
    All endpoints except `/health` and `/metrics` (aliases to `/v1/adapter/health` and `/v1/adapter/metrics`) require API key authentication
    via the `X-Adapter-API-Key` header.

    ## Field naming parity
    Responses use the universal adapter contract field names:
    - `transactionId` (formerly `transactionHash`)
    - `accountAddress` (formerly `contractAddress`)
    - `mintAddress` (formerly `tokenAddress`)

    Request validation matches the implementation: vote requests require `organizationId` in addition to the core vote fields (`voteId`, `proposalId`, `userId`, `optionId`, `votingPower`); `voterAddress` and `timestamp` are optional metadata; proposal results include `organizationId` and require `closedAt`.
    
    ## Rate Limits
    
    To prevent abuse and manage blockchain transaction costs:
    - Maximum 10 requests per second per API key
    - Maximum 100 transactions per hour per organization
    - 429 Too Many Requests returned when limits exceeded
    
    ## Transaction Flow
    
    1. Backend sends request to adapter endpoint
    2. Adapter builds and signs Polygon transaction
    3. Transaction submitted to Polygon RPC endpoint
    4. Adapter waits for confirmation (configurable block confirmations)
    5. Response returned with transaction hash and status
    
    ## Polygon-Specific Concepts
    
    - **Transaction Hash**: Ethereum-style hex string starting with 0x (~66 characters)
    - **Smart Contract Address**: Ethereum-style address for deployed contracts
    - **ERC-20 Token**: Ethereum token standard for fungible tokens
    - **Gas**: Computational cost for transaction execution
    - **Gas Price**: Price per unit of gas (in GWEI)
    - **Block Confirmations**: Number of blocks confirmed after transaction inclusion
    - **Network Selection**: Mumbai testnet vs. Polygon mainnet
    
  contact:
    name: FanEngagement Platform Team
    email: platform@fanengagement.io
  license:
    name: Proprietary
    
servers:
  - url: http://localhost:3002
    description: Local development
  - url: https://polygon-adapter-dev.fanengagement.io
    description: Development environment
  - url: https://polygon-adapter.fanengagement.io
    description: Production environment

security:
  - ApiKeyAuth: []
  - BearerAuth: []

tags:
  - name: Organizations
    description: Organization smart contract management on Polygon
  - name: ShareTypes
    description: ERC-20 token deployment for ShareTypes
  - name: Issuances
    description: Token minting and distribution to members
  - name: Proposals
    description: On-chain proposal creation and management
  - name: Voting
    description: Vote recording on Polygon blockchain
  - name: Results
    description: Proposal result commitment
  - name: Transactions
    description: Transaction status queries
  - name: Health
    description: Health checks and monitoring

paths:
  /v1/adapter/organizations:
    post:
      tags:
        - Organizations
      summary: Create organization on Polygon
      description: |
        Deploys a smart contract for an organization on the Polygon blockchain.
        
        The contract address is deterministically derived from the organization's UUID,
        ensuring the same organization ID always produces the same on-chain address.
        
        ## Polygon Implementation
        
        - **Contract Type**: Lightweight governance registry contract
        - **Contract Address**: Deterministically derived using CREATE2
        - **Gas Cost**: Approximately 200,000-300,000 gas units
        - **Network**: Configurable (mumbai testnet or polygon mainnet)
        
        ## Idempotency
        
        If the organization contract already exists at the derived address, the adapter
        returns the existing contract address without creating a duplicate.
        
      operationId: createOrganization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationRequest'
            examples:
              basic:
                summary: Basic organization
                value:
                  organizationId: "123e4567-e89b-12d3-a456-426614174000"
                  name: "Manchester United FC"
                  description: "Official governance for Manchester United supporters"
                  network: "mumbai"
      responses:
        '200':
          description: Organization created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateOrganizationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/share-types:
    post:
      tags:
        - ShareTypes
      summary: Deploy ERC-20 token contract for ShareType
      description: |
        Deploys an ERC-20 token contract for a FanEngagement ShareType.
        
        Each ShareType becomes a distinct fungible token on Polygon, with supply
        controlled by the platform's minter role.
        
        ## Token Standard Selection
        
        - **Transferable shares**: Standard ERC-20 for maximum ecosystem compatibility
        - **Non-transferable shares**: Custom ERC-20 with transfer restrictions
        
        ## Token Configuration
        
        - **Decimals**: 18 (standard for ERC-20, allows fractional shares if needed)
        - **Minter Role**: Platform-controlled address
        - **Pauser Role**: Platform-controlled address (for compliance)
        - **Metadata**: Token name and symbol stored on-chain
        
        ## Polygon Implementation
        
        - **Contract**: OpenZeppelin ERC-20 implementation
        - **Deployment**: CREATE2 for deterministic address
        - **Gas Cost**: Approximately 800,000-1,200,000 gas units
        - **Network**: Inherits from organization's network configuration
        
      operationId: createShareType
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateShareTypeRequest'
            examples:
              transferable:
                summary: Transferable share type
                value:
                  shareTypeId: "456e7890-a12b-34c5-d678-901234567890"
                  organizationId: "123e4567-e89b-12d3-a456-426614174000"
                  name: "Season Ticket Holder Share"
                  symbol: "MUFC-STH"
                  decimals: 18
                  maxSupply: "10000000000000000000000"
                  metadata:
                    votingWeight: 1.0
                  isTransferable: true
                  network: "mumbai"
      responses:
        '200':
          description: ShareType token contract deployed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateShareTypeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/share-issuances:
    post:
      tags:
        - Issuances
      summary: Issue shares to member (mint tokens)
      description: |
        Mints ERC-20 tokens to a member's wallet, representing share issuance.
        
        ## Wallet Resolution
        
        The adapter supports multiple wallet models:
        
        1. **Custodial Wallet (MVP)**: Adapter derives user wallet address from user UUID
        2. **User-Linked Wallet**: Member's connected Ethereum/Polygon wallet (MetaMask, WalletConnect)
        3. **Deferred Issuance**: Tokens held until member links wallet
        
        ## Token Amount
        
        - **With Decimals**: Quantity is in wei (smallest unit, e.g., 1000000000000000000 = 1 token with 18 decimals)
        - **MaxSupply Validation**: Adapter checks against on-chain max supply if set
        
        ## Gas Estimation
        
        The adapter estimates gas before submission and includes gas used in the response.
        
      operationId: recordShareIssuance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecordShareIssuanceRequest'
            examples:
              custodial:
                summary: Issue to custodial wallet
                value:
                  issuanceId: "abc12345-6789-def0-1234-567890abcdef"
                  shareTypeId: "456e7890-a12b-34c5-d678-901234567890"
                  userId: "12345678-1234-5678-90ab-cdef01234567"
                  quantity: "100000000000000000000"
                  network: "mumbai"
      responses:
        '200':
          description: Shares issued successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecordShareIssuanceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/proposals:
    post:
      tags:
        - Proposals
      summary: Create proposal on Polygon
      description: |
        Creates an on-chain proposal record for governance voting.
        
        ## Voting Model Support
        
        The adapter supports multiple voting models:
        
        - **Full On-Chain**: All votes recorded as blockchain transactions
        - **Hybrid**: Off-chain votes with on-chain result commitment
        - **Commitment Only**: Only final results hash stored on-chain (MVP)
        
        For the MVP (commitment only), this endpoint creates a minimal proposal
        record that will later receive the results hash.
        
        ## Proposal Storage
        
        - **Smart Contract**: Custom governance contract for proposal tracking
        - **Storage**: Proposal ID, status, timestamps, quorum, results hash (initially empty)
        - **Gas Cost**: Approximately 100,000-150,000 gas units
        - **Network**: Inherits from organization's network configuration
        
        ## Eligible Voting Power
        
        The `eligibleVotingPower` field captures a snapshot of total voting power
        at proposal creation time. This ensures consistent quorum calculations
        even if shares are issued/revoked during voting.
        
      operationId: createProposal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProposalRequest'
            examples:
              standard:
                summary: Standard proposal
                value:
                  proposalId: "abcd1234-5678-90ab-cdef-012345678901"
                  organizationId: "123e4567-e89b-12d3-a456-426614174000"
                  title: "Approve New Stadium Design"
                  contentHash: "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
                  startAt: "2024-12-10T00:00:00Z"
                  endAt: "2024-12-17T00:00:00Z"
                  eligibleVotingPower: 5000
                  eligibleShareTypeIds:
                    - "456e7890-a12b-34c5-d678-901234567890"
                  network: "mumbai"
      responses:
        '200':
          description: Proposal created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateProposalResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/votes:
    post:
      tags:
        - Voting
      summary: Record vote on Polygon
      description: |
        Records a member's vote on the Polygon blockchain.
        
        ## Voting Models
        
        **MVP (Off-Chain Voting)**: This endpoint is optional. Votes are stored
        in PostgreSQL, and only the final results hash is committed on-chain via
        `/v1/adapter/proposal-results`.
        
        **Future (On-Chain Voting)**: For high-stakes proposals, this endpoint
        creates a Vote Record in the governance smart contract.
        
        ## Vote Record Storage
        
        - **Smart Contract**: Governance contract with vote mapping
        - **Storage**: Voter address, option ID, voting power
        - **Gas Cost**: Approximately 50,000-80,000 gas units
        - **Uniqueness**: One vote record per voter per proposal
        
        ## Double-Vote Prevention
        
        The adapter checks if a vote record already exists for this voter
        and proposal. If it does, the transaction fails with a duplicate vote error.
        
      operationId: recordVote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecordVoteRequest'
            examples:
              standard_vote:
                summary: Member casts vote
                value:
                  voteId: "01234567-89ab-cdef-0123-456789abcdef"
                  proposalId: "abcd1234-5678-90ab-cdef-012345678901"
                  userId: "12345678-1234-5678-90ab-cdef01234567"
                  optionId: "option-a"
                  votingPower: 100
                  voterAddress: "0x8a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b"
                  timestamp: "2024-12-03T12:00:00Z"
                  network: "mumbai"
      responses:
        '200':
          description: Vote recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecordVoteResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Duplicate vote (user already voted on this proposal)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/proposal-results:
    post:
      tags:
        - Results
      summary: Commit proposal results to Polygon
      description: |
        Commits the final results of a proposal to the Polygon blockchain.
        
        This is the **primary mechanism** for the MVP voting model. Individual
        votes are stored off-chain (PostgreSQL), and this endpoint commits a
        cryptographic hash of the results on-chain for verifiability.
        
        ## Results Hash
        
        The results hash is a SHA-256 hash of:
        - Proposal ID
        - Winning option ID
        - Vote tallies per option
        - Total votes cast
        - Quorum status
        - Timestamp
        
        This hash serves as a tamper-proof commitment. Anyone can verify the
        results by:
        1. Obtaining the full vote data from the platform
        2. Computing the hash using the same algorithm
        3. Comparing against the on-chain commitment
        
        ## Gas Estimation
        
        Gas cost for results commitment is approximately 50,000-70,000 gas units.
        
      operationId: commitProposalResults
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommitProposalResultsRequest'
            examples:
              successful_proposal:
                summary: Proposal passed with quorum
                value:
                  proposalId: "abcd1234-5678-90ab-cdef-012345678901"
                  resultsHash: "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
                  winningOptionId: "option-a"
                  totalVotesCast: 3500
                  quorumMet: true
                  network: "mumbai"
                  closedAt: "2024-12-17T00:00:00Z"
      responses:
        '200':
          description: Results committed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommitProposalResultsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Results already committed (cannot update)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  /v1/adapter/transactions/{txId}:
    get:
      tags:
        - Transactions
      summary: Query transaction status
      description: |
        Retrieves the current status of a Polygon transaction.
        
        ## Transaction Lifecycle
        
        Polygon transactions go through multiple confirmation stages:
        
        1. **Pending**: Transaction submitted but not yet processed
        2. **Confirmed**: Transaction included in a block (1+ confirmations)
        3. **Finalized**: Transaction finalized (6+ confirmations recommended for finality)
        4. **Failed**: Transaction failed or rejected
        
        ## Polygon Explorer Integration
        
        The response includes a link to view the transaction on PolygonScan
        (Mumbai for testnet, Polygon for mainnet).
        
      operationId: getTransactionStatus
      parameters:
        - name: txId
          in: path
          required: true
          description: Polygon transaction hash (0x-prefixed hex string)
          schema:
            type: string
            pattern: '^0x[a-fA-F0-9]{64}$'
            example: "0x5e8f3c7b2d1a6e4f9a0b8c5d3e1f7a2b9c0d8e4f5a6b3c7d1e9f0a2b8c5d3e1f"
      responses:
        '200':
          description: Transaction status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionStatus'
        '404':
          description: Transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'

  /v1/adapter/health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: |
        Returns the health status of the Polygon adapter.
        
        This endpoint does not require authentication to allow monitoring
        systems and load balancers to check health without API keys.
        
        This endpoint is used by:
        - Kubernetes liveness probes
        - Kubernetes readiness probes
        - Monitoring systems (Prometheus, Datadog, etc.)
        - Circuit breaker health checks
        
      operationId: getHealth
      security: []
      responses:
        '200':
          description: Adapter is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Adapter is unhealthy (cannot connect to Polygon RPC or critical component failure)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /health:
    get:
      tags:
        - Health
      summary: Root health check
      description: |
        Same as `/v1/adapter/health` for compatibility with infrastructure health probes.
      operationId: getHealthRoot
      security: []
      responses:
        '200':
          description: Adapter is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'
        '503':
          description: Adapter is unhealthy (cannot connect to Polygon RPC or critical component failure)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatus'

  /v1/adapter/metrics:
    get:
      tags:
        - Health
      summary: Prometheus metrics endpoint
      description: |
        Returns Prometheus-compatible metrics for monitoring.
        
        ## Metrics Exposed
        
        **Transaction Metrics**:
        - `polygon_transactions_total{status,operation}`: Total transactions by status and operation type
        - `polygon_transaction_duration_seconds{operation}`: Transaction duration histogram
        - `polygon_gas_used_total{operation}`: Total gas consumed by operation type
        
        **RPC Metrics**:
        - `polygon_rpc_requests_total{status}`: Total RPC requests by status
        - `polygon_rpc_errors_total{error_type}`: Total RPC errors by type
        
        **Gas Metrics**:
        - `polygon_gas_price_gwei`: Current gas price in GWEI
        - `polygon_gas_estimate_units{operation}`: Gas estimation by operation type
        
      operationId: getMetrics
      security: []
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string

  /metrics:
    get:
      tags:
        - Health
      summary: Root metrics
      description: |
        Same as `/v1/adapter/metrics` for compatibility with infrastructure scraping.
      operationId: getMetricsRoot
      security: []
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-Adapter-API-Key
      description: |
        API key for authenticating requests to the Polygon adapter.
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        JWT Bearer token for authenticating requests to the Polygon adapter.

  schemas:
    CreateOrganizationRequest:
      type: object
      required:
        - organizationId
        - name
        - network
      properties:
        organizationId:
          type: string
          format: uuid
          description: FanEngagement organization UUID (used to derive contract address)
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Organization name (stored in contract metadata)
          example: "Manchester United FC"
        description:
          type: string
          maxLength: 500
          description: Organization description (optional)
          example: "Official governance for Manchester United supporters"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"
        metadata:
          type: object
          description: Organization branding metadata
          properties:
            logoUrl:
              type: string
              format: uri
              description: URL to organization logo image
              example: "https://cdn.fanengagement.io/logos/manutd.png"
            colors:
              type: object
              description: Organization brand colors
              properties:
                primary:
                  type: string
                  pattern: "^#([A-Fa-f0-9]{6})$"
                  description: Primary brand color (hex)
                  example: "#DA291C"
                secondary:
                  type: string
                  pattern: "^#([A-Fa-f0-9]{6})$"
                  description: Secondary brand color (hex)
                  example: "#FBE122"

    CreateOrganizationResponse:
      type: object
      required:
        - transactionHash
        - contractAddress
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x5e8f3c7b2d1a6e4f9a0b8c5d3e1f7a2b9c0d8e4f5a6b3c7d1e9f0a2b8c5d3e1f"
        contractAddress:
          type: string
          description: Deployed smart contract address
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x7a2b8c5d3e1f9a0b4c6d8e2f1a3b5c7d9e0f2a4b"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 245000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "35.5"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345678
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of transaction confirmation
          example: "2024-12-03T16:05:00Z"

    CreateShareTypeRequest:
      type: object
      required:
        - shareTypeId
        - organizationId
        - name
        - symbol
        - decimals
        - network
      properties:
        shareTypeId:
          type: string
          format: uuid
          description: FanEngagement ShareType UUID
          example: "456e7890-a12b-34c5-d678-901234567890"
        organizationId:
          type: string
          format: uuid
          description: Parent organization UUID
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: ShareType name (stored in token metadata)
          example: "Season Ticket Holder Share"
        symbol:
          type: string
          minLength: 1
          maxLength: 10
          pattern: '^[A-Z0-9-]+$'
          description: Token symbol (uppercase alphanumeric with hyphens)
          example: "MUFC-STH"
        decimals:
          type: integer
          format: int32
          minimum: 0
          maximum: 18
          description: Number of decimal places for token (18 is standard for ERC-20)
          example: 18
        maxSupply:
          type: string
          nullable: true
          description: Maximum token supply in wei (null = unlimited). Use string to avoid integer overflow.
          example: "10000000000000000000000"
        metadata:
          type: object
          description: ShareType metadata including voting configuration
          properties:
            description:
              type: string
              description: ShareType description
              example: "Governance share for season ticket holders"
            votingWeight:
              type: number
              format: double
              minimum: 0
              description: Voting weight per token (0 = non-voting)
              example: 1.0
        isTransferable:
          type: boolean
          description: Whether tokens can be transferred between users (Polygon-specific, enables/disables transfer restrictions)
          example: true
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"

    CreateShareTypeResponse:
      type: object
      required:
        - transactionHash
        - tokenAddress
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x3b7f2a9c8d5e1f0a6b4c8d2e9f1a3b7c5d0e8f2a4b6c9d1e3f5a7b0c8d2e4f1a"
        tokenAddress:
          type: string
          description: ERC-20 token contract address
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x9a0b3c5d7e1f2a4b6c8d0e2f4a6b8c0d2e4f6a8b"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 1145000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "42.3"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345679
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
          example: "2024-12-03T16:06:00Z"

    RecordShareIssuanceRequest:
      type: object
      required:
        - issuanceId
        - shareTypeId
        - userId
        - quantity
        - network
      properties:
        issuanceId:
          type: string
          format: uuid
          description: FanEngagement ShareIssuance UUID
          example: "abc12345-6789-def0-1234-567890abcdef"
        shareTypeId:
          type: string
          format: uuid
          description: ShareType UUID (identifies token contract)
          example: "456e7890-a12b-34c5-d678-901234567890"
        userId:
          type: string
          format: uuid
          description: User UUID (used to derive custodial wallet address)
          example: "12345678-1234-5678-90ab-cdef01234567"
        quantity:
          type: string
          description: Number of tokens to mint in wei (smallest unit). Use string to avoid integer overflow.
          example: "100000000000000000000"
        recipientAddress:
          type: string
          nullable: true
          description: Optional Polygon wallet address (if user linked wallet, otherwise custodial address derived from userId)
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x8a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"
        metadata:
          type: object
          nullable: true
          description: Optional metadata for audit trail
          properties:
            reason:
              type: string
              description: Reason for share issuance
              example: "Initial allocation"
            issuedBy:
              type: string
              description: ID of the admin or system issuing the shares
              example: "admin-user-id"

    RecordShareIssuanceResponse:
      type: object
      required:
        - transactionHash
        - recipientAddress
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x4c8d2e0f1a3b5c7d9e1f3a5b7c9d1e3f5a7b9c1d3e5f7a9b1c3d5e7f9a1b3c5d"
        recipientAddress:
          type: string
          description: Polygon wallet address that received the tokens
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x6b8c0d2e4f6a8b0c2d4e6f8a0b2c4d6e8f0a2b4c"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 65000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "38.7"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345680
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
          example: "2024-12-03T16:07:00Z"

    CreateProposalRequest:
      type: object
      required:
        - proposalId
        - organizationId
        - title
        - contentHash
        - startAt
        - endAt
        - eligibleVotingPower
        - network
      properties:
        proposalId:
          type: string
          format: uuid
          description: FanEngagement Proposal UUID
          example: "abcd1234-5678-90ab-cdef-012345678901"
        organizationId:
          type: string
          format: uuid
          description: Parent organization UUID
          example: "123e4567-e89b-12d3-a456-426614174000"
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Proposal title (stored on-chain)
          example: "Approve New Stadium Design"
        contentHash:
          type: string
          pattern: '^[a-f0-9]{64}$'
          description: SHA-256 hash of proposal content for verification
          example: "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
        startAt:
          type: string
          format: date-time
          description: Voting start timestamp (ISO 8601)
          example: "2024-12-10T00:00:00Z"
        endAt:
          type: string
          format: date-time
          description: Voting end timestamp (ISO 8601)
          example: "2024-12-17T00:00:00Z"
        eligibleVotingPower:
          type: number
          format: double
          minimum: 0
          description: Total voting power eligible (snapshot)
          example: 5000
        eligibleShareTypeIds:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          description: List of ShareType UUIDs eligible to vote (optional, for Polygon-specific filtering)
          example:
            - "456e7890-a12b-34c5-d678-901234567890"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"

    CreateProposalResponse:
      type: object
      required:
        - transactionHash
        - contractAddress
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x7d9e1f3a5b7c9d1e3f5a7b9c1d3e5f7a9b1c3d5e7f9a1b3c5d7e9f1a3b5c7d9e"
        contractAddress:
          type: string
          description: Smart contract address for proposal (if separate contract deployed)
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x5c7d9e1f3a5b7c9d1e3f5a7b9c1d3e5f7a9b1c3d"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 125000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "41.2"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345681
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
          example: "2024-12-03T16:08:00Z"

    RecordVoteRequest:
      type: object
      required:
        - voteId
        - proposalId
        - userId
        - optionId
        - votingPower
        - voterAddress
        - timestamp
        - network
      properties:
        voteId:
          type: string
          format: uuid
          description: FanEngagement Vote UUID
          example: "01234567-89ab-cdef-0123-456789abcdef"
        proposalId:
          type: string
          format: uuid
          description: Proposal UUID being voted on
          example: "abcd1234-5678-90ab-cdef-012345678901"
        userId:
          type: string
          format: uuid
          description: User UUID casting the vote
          example: "12345678-1234-5678-90ab-cdef01234567"
        optionId:
          type: string
          description: Option ID selected by voter
          example: "option-a"
        votingPower:
          type: number
          format: double
          minimum: 0
          description: Voting power of this vote (calculated off-chain)
          example: 100
        voterAddress:
          type: string
          description: Blockchain-specific address of the voter (Polygon wallet or custodial address)
          pattern: '^0x[a-fA-F0-9]{40}$'
          example: "0x8a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the vote was cast
          example: "2024-12-03T12:00:00Z"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"

    RecordVoteResponse:
      type: object
      required:
        - transactionHash
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x8e0f2a4b6c8d0e2f4a6b8c0d2e4f6a8b0c2d4e6f8a0b2c4d6e8f0a2b4c6d8e0f"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 55000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "39.5"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345682
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
          example: "2024-12-03T16:09:00Z"

    CommitProposalResultsRequest:
      type: object
      required:
        - proposalId
        - resultsHash
        - totalVotesCast
        - quorumMet
        - closedAt
        - network
      properties:
        proposalId:
          type: string
          format: uuid
          description: Proposal UUID to commit results for
          example: "abcd1234-5678-90ab-cdef-012345678901"
        resultsHash:
          type: string
          pattern: '^[a-f0-9]{64}$'
          description: SHA-256 hash of proposal results (64 hex chars)
          example: "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
        winningOptionId:
          type: string
          nullable: true
          description: ID of winning option (required if quorumMet is true, null otherwise)
          example: "option-a"
        totalVotesCast:
          type: number
          format: double
          minimum: 0
          description: Total voting power cast
          example: 3500
        quorumMet:
          type: boolean
          description: Whether quorum requirement was met
          example: true
        closedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when proposal closed
          example: "2024-12-17T00:00:00Z"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network (mumbai for testnet, polygon for mainnet)
          example: "mumbai"

    CommitProposalResultsResponse:
      type: object
      required:
        - transactionHash
        - gasUsed
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x9f1a3b5c7d9e1f3a5b7c9d1e3f5a7b9c1d3e5f7a9b1c3d5e7f9a1b3c5d7e9f1a"
        gasUsed:
          type: integer
          format: int64
          description: Actual gas consumed by transaction
          example: 58000
        gasPrice:
          type: string
          description: Gas price used for transaction (in GWEI)
          example: "43.8"
        blockNumber:
          type: integer
          format: int64
          description: Block number where transaction was included
          example: 12345683
        status:
          type: string
          enum: [confirmed, finalized]
          description: Transaction confirmation status
          example: "confirmed"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
          example: "2024-12-17T00:01:00Z"

    TransactionStatus:
      type: object
      required:
        - transactionHash
        - status
        - timestamp
      properties:
        transactionHash:
          type: string
          description: Polygon transaction hash (0x-prefixed hex string)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x5e8f3c7b2d1a6e4f9a0b8c5d3e1f7a2b9c0d8e4f5a6b3c7d1e9f0a2b8c5d3e1f"
        status:
          type: string
          enum: [pending, confirmed, finalized, failed]
          description: Transaction status
          example: "finalized"
        confirmations:
          type: integer
          format: int32
          minimum: 0
          nullable: true
          description: Number of block confirmations (null if pending/failed)
          example: 12
        blockNumber:
          type: integer
          format: int64
          nullable: true
          description: Block number (null if pending/failed)
          example: 12345678
        blockTime:
          type: string
          format: date-time
          nullable: true
          description: Block timestamp (null if pending/failed)
          example: "2024-12-03T16:05:30Z"
        gasUsed:
          type: integer
          format: int64
          nullable: true
          description: Gas consumed by transaction (null if pending/failed)
          example: 245000
        gasPrice:
          type: string
          nullable: true
          description: Gas price used for transaction in GWEI (null if pending/failed)
          example: "35.5"
        timestamp:
          type: string
          format: date-time
          description: Query timestamp (ISO 8601)
          example: "2024-12-03T16:12:00Z"
        error:
          type: string
          nullable: true
          description: Error message if transaction failed
          example: "Insufficient funds for gas"
        explorerUrl:
          type: string
          format: uri
          description: Link to transaction on PolygonScan
          example: "https://mumbai.polygonscan.com/tx/0x5e8f3c7b2d1a6e4f9a0b8c5d3e1f7a2b9c0d8e4f5a6b3c7d1e9f0a2b8c5d3e1f"

    HealthStatus:
      type: object
      required:
        - status
        - blockchain
        - network
        - rpcStatus
        - timestamp
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: Overall health status
          example: "healthy"
        blockchain:
          type: string
          enum: [polygon]
          description: Blockchain type
          example: "polygon"
        network:
          type: string
          enum: [mumbai, polygon]
          description: Polygon network
          example: "mumbai"
        rpcStatus:
          type: string
          enum: [connected, disconnected, degraded]
          description: RPC connection status
          example: "connected"
        lastBlockNumber:
          type: integer
          format: int64
          nullable: true
          description: Latest block number (null if unavailable)
          example: 12345678
        gasPrice:
          type: string
          nullable: true
          description: Current gas price in GWEI (null if unavailable)
          example: "35.5"
        rpcEndpoint:
          type: string
          format: uri
          description: Polygon RPC endpoint URL
          example: "https://rpc-mumbai.maticvigil.com"
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of health check
          example: "2024-12-03T16:12:00Z"
        error:
          type: string
          nullable: true
          description: Error message if unhealthy
          example: "Failed to connect to Polygon RPC endpoint"

    ProblemDetails:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: URI identifying the problem type
          example: "https://fanengagement.io/errors/invalid-request"
        title:
          type: string
          description: Short human-readable summary
          example: "Invalid Request"
        status:
          type: integer
          format: int32
          description: HTTP status code
          example: 400
        detail:
          type: string
          description: Human-readable explanation
          example: "Field 'organizationId' is required"
        instance:
          type: string
          description: URI identifying the specific occurrence
          example: "/v1/adapter/organizations"
        transactionHash:
          type: string
          nullable: true
          description: Polygon transaction hash if applicable (0x-prefixed hex)
          pattern: '^0x[a-fA-F0-9]{64}$'
          example: "0x5e8f3c7b2d1a6e4f9a0b8c5d3e1f7a2b9c0d8e4f5a6b3c7d1e9f0a2b8c5d3e1f"

  responses:
    BadRequest:
      description: Bad request - invalid input data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'

    Unauthorized:
      description: Unauthorized - invalid or missing API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'

    ServiceUnavailable:
      description: Service unavailable - Polygon RPC endpoint is down
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
